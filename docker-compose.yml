version: "3.9"

services:
  db:
    image: mysql:8
    container_name: interviewallversion2-db
    environment:
      MYSQL_DATABASE: testdb
      MYSQL_USER: springuser
      MYSQL_PASSWORD: springpass
      MYSQL_ROOT_PASSWORD: rootpass
    ports:
      - "3307:3306"
    networks:
      - app-net

  app:
    image: java-single-env:latest
    container_name: interviewallversion2-app
    deploy:
      replicas: 1
    networks:
      - app-net
    volumes:
      # Mount your WSL properties file inside the container
      - /home/ashish/InterviewAllVersion/src/main/resources/application-wsl.properties:/app/config/application-wsl.properties
    environment:
      # Tell Spring Boot (or your app) which profile to use
      - SPRING_PROFILES_ACTIVE=wsl
      - SPRING_CONFIG_LOCATION=/app/config/application-wsl.properties
    depends_on:
      - db

  nginx:
    image: nginx:latest
    container_name: interviewallversion2-nginx
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - app
    networks:
      - app-net

networks:
  app-net:
    driver: bridge







# version: '3.8'

# services:
#   db:
#     image: mysql:8
#     restart: always
#     environment:
#       MYSQL_DATABASE: testdb
#       MYSQL_USER: springuser
#       MYSQL_PASSWORD: springpass
#       MYSQL_ROOT_PASSWORD: rootpass
#     ports:
#       - "3306:3306"
#     volumes:
#       - db_data:/var/lib/mysql
#     healthcheck:
#       test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
#       interval: 10s
#       retries: 5

#   app:
#     build: .
#     image: java-single-env:latest
#     restart: on-failure
#     environment:
#       SPRING_DATASOURCE_URL: jdbc:mysql://db:3306/testdb
#       SPRING_DATASOURCE_USERNAME: springuser
#       SPRING_DATASOURCE_PASSWORD: springpass
#       SPRING_PROFILES_ACTIVE: wsl
#     depends_on:
#       db:
#         condition: service_healthy
#     deploy:
#       replicas: 3   # Multiple instances
#     ports:
#       - "8080"      # Docker will map dynamically, Nginx will load balance

#   nginx:
#     image: nginx:latest
#     ports:
#       - "80:80"
#     volumes:
#       - ./nginx.conf:/etc/nginx/nginx.conf:ro
#     depends_on:
#       - app

# volumes:
#   db_data:





# version: '3.8'

# services:
#   db:
#     image: mysql:8
#     container_name: mydb
#     restart: always
#     environment:
#       MYSQL_DATABASE: testdb
#       MYSQL_USER: springuser
#       MYSQL_PASSWORD: springpass
#       MYSQL_ROOT_PASSWORD: rootpass
#     ports:
#       - "3306:3306"
#     volumes:
#       - db_data:/var/lib/mysql
#     healthcheck:
#       test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
#       interval: 10s
#       retries: 5

#   app:
#     build: .                  # Dockerfile in current directory
#     image: java-single-env:latest
#     container_name: myapp
#     restart: on-failure
#     environment:
#       SPRING_DATASOURCE_URL: jdbc:mysql://db:3306/testdb
#       SPRING_DATASOURCE_USERNAME: springuser
#       SPRING_DATASOURCE_PASSWORD: springpass
#     depends_on:
#       db:
#         condition: service_healthy
#     ports:
#       - "8081:8080"

# volumes:
#   db_data


#multi-server-configuration
# version: '3.8'

# services:
#   db-dev:
#     image: mysql:8
#     container_name: mydb-dev
#     environment:
#       MYSQL_DATABASE: testdb
#       MYSQL_USER: springuser
#       MYSQL_PASSWORD: springpass
#       MYSQL_ROOT_PASSWORD: rootpass
#     ports:
#       - "3307:3306"
#     networks:
#       - myapp-network
#     healthcheck:
#       test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
#       interval: 5s
#       timeout: 5s
#       retries: 10

#   db-qa:
#     image: mysql:8
#     container_name: mydb-qa
#     environment:
#       MYSQL_DATABASE: testdb
#       MYSQL_USER: springuser
#       MYSQL_PASSWORD: springpass
#       MYSQL_ROOT_PASSWORD: rootpass
#     ports:
#       - "3308:3306"
#     networks:
#       - myapp-network
#     healthcheck:
#       test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
#       interval: 5s
#       timeout: 5s
#       retries: 10

#   app-dev:
#     image: java-multi-env:${VERSION}
#     container_name: myapp-dev
#     environment:
#       SPRING_PROFILES_ACTIVE: dev
#     ports:
#       - "8081:8080"
#     depends_on:
#       db-dev:
#         condition: service_healthy
#     networks:
#       - myapp-network

#   app-qa:
#     image: java-multi-env:${VERSION}
#     container_name: myapp-qa
#     environment:
#       SPRING_PROFILES_ACTIVE: qa
#     ports:
#       - "8082:8080"
#     depends_on:
#       db-qa:
#         condition: service_healthy
#     networks:
#       - myapp-network

#   load-balancer:
#     image: nginx:alpine
#     container_name: myapp-lb
#     ports:
#       - "8080:80"
#     depends_on:
#       - app-dev
#       - app-qa
#     volumes:
#       - ./nginx.conf:/etc/nginx/nginx.conf:ro
#     networks:
#       - myapp-network

# networks:
#   myapp-network:
#     driver: bridge



